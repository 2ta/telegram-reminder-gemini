import os
from typing import Optional, Union, Literal
from pydantic_settings import BaseSettings, SettingsConfigDict
from pydantic import Field, PostgresDsn, AnyHttpUrl

class Settings(BaseSettings):
    model_config = SettingsConfigDict(env_file='.env', env_file_encoding='utf-8', extra='ignore')

    # Telegram API Configuration
    TELEGRAM_BOT_TOKEN: str

    # Database Configuration
    DATABASE_URL: Union[PostgresDsn, str] = "sqlite:///./default.db"
    DATABASE_URL_TEST: Optional[Union[PostgresDsn, str]] = "sqlite:///./test.db"

    # Google Cloud / Gemini Configuration
    GOOGLE_APPLICATION_CREDENTIALS: Optional[str] = None
    GEMINI_PROJECT_ID: Optional[str] = None
    GEMINI_LOCATION: Optional[str] = None
    GEMINI_MODEL_NAME: str = "gemini-2.0-flash"
    GEMINI_API_KEY: Optional[str] = None

    # Payment Gateway (Zibal) Configuration
    ZIBAL_MERCHANT_KEY: Optional[str] = None
    PAYMENT_CALLBACK_URL_BASE: Optional[AnyHttpUrl] = None

    # Logging Configuration
    LOG_LEVEL: Literal["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"] = "INFO"
    LOG_FILE_PATH: str = "logs/bot.log"
    LOG_FILE_MAX_BYTES: int = 1024 * 1024 * 5  # 5MB
    LOG_FILE_BACKUP_COUNT: int = 3

    # Other application settings
    DEFAULT_LANGUAGE: str = "fa"

    # Tier configurations for reminders
    MAX_REMINDERS_FREE_TIER: int = Field(default=5, description="Maximum active reminders for free tier users")
    MAX_REMINDERS_PREMIUM_TIER: int = Field(default=100, description="Maximum active reminders for premium tier users")
    REMINDERS_PER_PAGE: int = Field(default=5, description="Number of reminders to show per page in lists")

    # Feature flags
    IGNORE_REMINDER_LIMITS: bool = Field(default=False, description="If True, ignores reminder limits for all users (development mode)")

    # Environment setting (dev, test, prod)
    APP_ENV: Literal["development", "testing", "production"] = "development"

settings = Settings()

# --- Persian Messages (Module-level constants) ---
MSG_WELCOME: str = (
    "๐ ุจู ุฑุจุงุช ุงุฏุขูุฑ ูพุดุฑูุชู ุฎูุด ุขูุฏุฏ! ๐\n\n"
    "ูู ุงูุฌุง ูุณุชู ุชุง ุจู ุดูุง ฺฉูฺฉ ฺฉูู ูฺ ูุฑุงุฑ ููุงูุงุชุ ูุธูู ุง ุฑูุฏุงุฏ ููู ุฑุง ูุฑุงููุด ูฺฉูุฏ. "
    "ููุท ฺฉุงูุณุช ุจู ูู ุจฺฏูุฏ ฺู ฺุฒ ุฑุง ุจุงุฏ ุจู ุดูุง ุงุฏุขูุฑ ฺฉูู ู ฺู ุฒูุงู!\n\n"
    "๐ ุดุฑูุน ุณุฑุน:\n"
    "ฺฉุงูุณุช ูพุงู ุดุจู ุจู ุงู ุงุฑุณุงู ฺฉูุฏ: ยซุงุฏู ุจูุฏุงุฒ ูุฑุฏุง ุณุงุนุช ฑฐ ุตุจุญ ุฌูุณู ููู ุจุง ุชู ูพุฑูฺู ุฏุงุฑูยป\n\n"
    "โจ ุงูฺฉุงูุงุช ุฑุจุงุช:\n"
    "- ุงุฌุงุฏ ุงุฏุขูุฑ ุจุง ุฒุจุงู ุทุจุน ูุงุฑุณ (ู ุจู ุฒูุฏ ุงูฺฏูุณ!)\n"
    "- ุชุดุฎุต ููุดููุฏ ุชุงุฑุฎ ู ุณุงุนุช ุงุฒ ูพุงู ุดูุง (ุญุช ุชุงุฑุฎ ุดูุณ!)\n"
    "- ุงูฺฉุงู ูุดุงูุฏู ู ูุฏุฑุช ุงุฏุขูุฑูุง ูุนุงู\n"
    "- (ุจู ุฒูุฏ) ุชูุธู ุงุฏุขูุฑูุง ุชฺฉุฑุงุฑุดููุฏู\n"
    "- (ุจู ุฒูุฏ) ุงูฺฉุงู ูพุฑุฏุงุฎุช ู ูุนุงูุณุงุฒ ุงุดุชุฑุงฺฉ ูฺู ุจุฑุง ุงูฺฉุงูุงุช ุจุดุชุฑ\n\n"
    "๐ ุญุฑู ุฎุตูุต ุดูุง ุจุฑุง ูุง ููู ุงุณุช. ุจุฑุง ุงุทูุงุน ุงุฒ ูุญูู ุงุณุชูุงุฏู ุงุฒ ุงุทูุงุนุงุช ุดูุงุ ูุทูุงู /privacy ุฑุง ูุดุงูุฏู ฺฉูุฏ."
)
MSG_HELP: str = (
    "ุฑุงูููุง ุฑุจุงุช ุงุฏุขูุฑ:\n"
    "- ุจุฑุง ุงุฌุงุฏ ุงุฏุขูุฑ: ูุซูุง ุจููุณุฏ: 'ุงุฏุขูุฑ ฺฉู ูุฑุฏุง ุณุงุนุช ฑฐ ุตุจุญ ุฌูุณู ุฏุงุฑู'\n"
    "- ุจุฑุง ุฏุฏู ุงุฏุขูุฑูุง: /reminders ุง 'ุงุฏุขูุฑูุง ูู'\n"
    "- ุจุฑุง ูุบู ุนููุงุช ูุนู: /cancel\n"
    "- ุจุฑุง ุฏุฑุงูุช ุงู ุฑุงูููุง: /help\n"
    "- ุจุฑุง ุงุทูุงุน ุงุฒ ูุถุนุช ุงุดุชุฑุงฺฉ ู ูพุฑุฏุงุฎุช: /pay\n"
    "- ุจุฑุง ูุดุงูุฏู ุณุงุณุช ุญูุธ ุญุฑู ุฎุตูุต: /privacy"
)
MSG_PRIVACY_POLICY: str = (
    "ุณุงุณุช ุญูุธ ุญุฑู ุฎุตูุต ุฑุจุงุช ุงุฏุขูุฑ:\n\n"
    "ูุง ุจู ุญุฑู ุฎุตูุต ุดูุง ุงุญุชุฑุงู ูโฺฏุฐุงุฑู.\n"
    "1. ุงุทูุงุนุงุช ุฌูุนโุขูุฑ ุดุฏู: \n"
    "   - ุดูุงุณู ฺฉุงุฑุจุฑ ุชูฺฏุฑุงู ู ุดูุงุณู ฺุช: ุจุฑุง ุงุฑุงุฆู ุฎุฏูุงุช ู ุงุฑุณุงู ุงุฏุขูุฑูุง.\n"
    "   - ูุงู ฺฉุงุฑุจุฑ ู ูุงู (ุงุฎุชุงุฑ): ุจุฑุง ุดุฎุตโุณุงุฒ ุชุฌุฑุจู ุดูุง.\n"
    "   - ูุญุชูุง ุงุฏุขูุฑูุง: ุจุฑุง ุฐุฎุฑู ู ุงุฑุณุงู ุงุฏุขูุฑูุง ุดูุง.\n"
    "   - ูุงูโูุง ุตูุช (ุฏุฑ ุตูุฑุช ุงุฑุณุงู): ุจุฑุง ุชุจุฏู ุจู ูุชู ู ุงุฌุงุฏ ุงุฏุขูุฑ.\n"
    "2. ุงุณุชูุงุฏู ุงุฒ ุงุทูุงุนุงุช:\n"
    "   - ุงุทูุงุนุงุช ุดูุง ุตุฑูุงู ุจุฑุง ุนููฺฉุฑุฏ ุตุญุญ ุฑุจุงุช ู ุงุฑุงุฆู ุฎุฏูุงุช ุงุฏุขูุฑ ุงุณุชูุงุฏู ูโุดูุฏ.\n"
    "   - ูุง ุงุทูุงุนุงุช ุดูุง ุฑุง ุจุง ูฺ ุดุฎุต ุซุงูุซ ุจู ุงุดุชุฑุงฺฉ ููโฺฏุฐุงุฑูุ ูฺฏุฑ ุฏุฑ ููุงุฑุฏ ฺฉู ูุงููู ุงุฌุงุจ ฺฉูุฏ.\n"
    "3. ุฐุฎุฑูโุณุงุฒ ุงุทูุงุนุงุช:\n"
    "   - ุงุทูุงุนุงุช ุงุฏุขูุฑูุง ู ูุงูโูุง ุตูุช ูููุชุงู ุชุง ุฒูุงู ูพุฑุฏุงุฒุด ู ุงุฑุณุงู ุงุฏุขูุฑ ุฐุฎุฑู ูโุดููุฏ.\n"
    "   - ูุงูโูุง ุตูุช ูพุณ ุงุฒ ูพุฑุฏุงุฒุด ู ุชุจุฏู ุจู ูุชูุ ุฏุฑ ุงุณุฑุน ููุช ุญุฐู ูโฺฏุฑุฏูุฏ.\n"
    "4. ุงููุช:\n"
    "   - ูุง ุชูุงุด ูโฺฉูู ุชุง ุงุฒ ุงุทูุงุนุงุช ุดูุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุฑูุดโูุง ุงููุช ููุงุณุจ ูุญุงูุธุช ฺฉูู.\n"
    "5. ุชุบุฑุงุช ุฏุฑ ุณุงุณุช ุญูุธ ุญุฑู ุฎุตูุต:\n"
    "   - ูุฑฺฏููู ุชุบุฑ ุฏุฑ ุงู ุณุงุณุช ุงุฒ ุทุฑู ููู ุฑุจุงุช ุจู ุงุทูุงุน ุดูุง ุฎูุงูุฏ ุฑุณุฏ.\n\n"
    "ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ุฑุจุงุชุ ุดูุง ุจุง ุงู ุณุงุณุช ููุงููุช ูโฺฉูุฏ."
)
MSG_PAYMENT_PROMPT: str = "ุจุฑุง ุฏุณุชุฑุณ ุจู ุงูฺฉุงูุงุช ูฺู ู ุชุนุฏุงุฏ ุงุฏุขูุฑูุง ุจุดุชุฑุ ูโุชูุงูุฏ ุงุดุชุฑุงฺฉ ุฎูุฏ ุฑุง ุงุฑุชูุง ุฏูุฏ. ูุฒูู ุงุดุชุฑุงฺฉ: {amount} ุชููุงู."


if __name__ == "__main__":
    print("Current Configuration Loaded via Pydantic:")
    print(settings.model_dump_json(indent=2))
    print("\nModule-level messages:")
    print(f"MSG_WELCOME: {MSG_WELCOME}")
    print(f"MSG_HELP: {MSG_HELP}")
    print(f"MSG_PRIVACY_POLICY: {MSG_PRIVACY_POLICY}")
    print(f"MSG_PAYMENT_PROMPT: {MSG_PAYMENT_PROMPT}")

# Message Constants
MSG_FILTER_DATE_PARSE_ERROR = "ูุชุงุณูุงูู ูุชูุงูุณุชู ุนุจุงุฑุช ุชุงุฑุฎ \"{phrase}\" ุฑุง ุจุฑุง ููุชุฑ ฺฉุฑุฏู ูุชูุฌู ุดูู. ูุทูุงู ุฏูุจุงุฑู ุงูุชุญุงู ฺฉูุฏ."
MSG_FILTER_UNSUCCESSFUL = "ูุชูุงูุณุชู ููุชุฑ ูุดุฎุต ุดุฏู ุจุง ุนุจุงุฑุช \"{text}\" ุฑุง ุงุนูุงู ฺฉูู. ูุทูุงู ุฏูุจุงุฑู ุงูุชุญุงู ฺฉูุฏ ุง ุนุจุงุฑุช ุฏฺฏุฑ ุจู ฺฉุงุฑ ุจุจุฑุฏ."
MSG_FILTERS_APPLIED = "ููุชุฑูุง ุฒุฑ ุงุนูุงู ุดุฏูุฏ: "
MSG_FILTER_NO_CRITERIA_FOUND = "ุนุจุงุฑุช \"{text}\" ุดุงูู ูุนุงุฑ ูุงุจู ุชุดุฎุต ุจุฑุง ููุชุฑ ฺฉุฑุฏู ูุจูุฏ."
MSG_FILTER_NLU_ERROR = "ุฎุทุง ุฏุฑ ูพุฑุฏุงุฒุด ุนุจุงุฑุช ููุชุฑ \"{text}\" ุฑุฎ ุฏุงุฏ. ูุทูุงู ุฏูุจุงุฑู ุงูุชุญุงู ฺฉูุฏ."
MSG_LIST_EMPTY_WITH_FILTERS = "ูฺ ุงุฏุขูุฑ ุจุง ููุชุฑูุง ุงุนูุงู ุดุฏู ุงูุช ูุดุฏ."
MSG_LIST_HEADER_WITH_FILTERS = "ุงุฏุขูุฑูุง ุดูุง (ููุชุฑ ุดุฏู):"

# General Messages
MSG_ERROR_GENERIC = "ูุชุงุณูุงูู ุฎุทุง ุฑุฎ ุฏุงุฏ. ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ ุง ุจุง ูพุดุชุจุงู ุชูุงุณ ุจฺฏุฑุฏ."
MSG_SUCCESS_GENERIC = "ุนููุงุช ุจุง ููููุช ุงูุฌุงู ุดุฏ."
MSG_NOT_IMPLEMENTED_YET = "ุงู ูุงุจูุช ูููุฒ ูพุงุฏูโุณุงุฒ ูุดุฏู ุงุณุช. ุจู ุฒูุฏ ุงุถุงูู ุฎูุงูุฏ ุดุฏ!"
MSG_PAYMENT_BUTTON = "๐ณ ุงุฏุขูุฑ ูุงูุญุฏูุฏ"
MSG_PAYMENT_SUCCESS = "ูพุฑุฏุงุฎุช ุดูุง ุจุง ููููุช ุงูุฌุงู ุดุฏ. ุงุดุชุฑุงฺฉ ูฺู ุดูุง ุชุง ุชุงุฑุฎ {expiry_date} ูุนุงู ุดุฏ."
MSG_PAYMENT_SUCCESS_GENERIC = "ูพุฑุฏุงุฎุช ุดูุง ุจุง ููููุช ุงูุฌุงู ุดุฏ ู ุงุดุชุฑุงฺฉ ูฺู ุดูุง ูุนุงู ุดุฏ."
MSG_PAYMENT_FAILED = "ูุชุงุณูุงูู ูพุฑุฏุงุฎุช ุดูุง ูุงูููู ุจูุฏ. ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ ุง ุจุง ูพุดุชุจุงู ุชูุงุณ ุจฺฏุฑุฏ."
MSG_PAYMENT_CANCELLED = "ูพุฑุฏุงุฎุช ุชูุณุท ุดูุง ูุบู ุดุฏ."
MSG_PAYMENT_ALREADY_VERIFIED = "ุงู ูพุฑุฏุงุฎุช ูุจูุงู ุชุงุฏ ุดุฏู ุงุณุช."
MSG_PAYMENT_PENDING_VERIFICATION = "ูุถุนุช ูพุฑุฏุงุฎุช ุดูุง ูููุฒ ูุงูุดุฎุต ุงุณุช. ูุทูุงู ฺฉู ุตุจุฑ ฺฉูุฏ ู ูุฌุฏุฏุงู ุจุฑุฑุณ ููุงุฏ."
MSG_PAYMENT_VERIFICATION_ERROR = "ุฎุทุง ุฏุฑ ุชุงุฏ ูพุฑุฏุงุฎุช: {error}. ุงฺฏุฑ ูุจูุบ ุงุฒ ุญุณุงุจ ุดูุง ฺฉุณุฑ ุดุฏูุ ุท ทฒ ุณุงุนุช ุขูุฏู ุจู ุญุณุงุจ ุดูุง ุจุงุฒ ุฎูุงูุฏ ฺฏุดุช."
MSG_PAYMENT_ERROR = "ุฎุทุง ุฏุฑ ุงุฌุงุฏ ููฺฉ ูพุฑุฏุงุฎุช. ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ."
MSG_PAYMENT_CONFIG_ERROR = "ุฎุทุง ุฏุฑ ุชูุธูุงุช ูพุฑุฏุงุฎุช. ูุทูุงู ุจุง ูุฏุฑ ุฑุจุงุช ุชูุงุณ ุจฺฏุฑุฏ."

# Reminder specific messages
MSG_REMINDER_SET = "ุงุฏุขูุฑ ุดูุง ุจุฑุง \"{task}\" ุฏุฑ ุชุงุฑุฎ {date} ุณุงุนุช {time} ุชูุธู ุดุฏ."
MSG_REMINDER_NOT_FOUND = "ุงุฏุขูุฑ ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ."
MSG_REMINDER_DELETED = "ุงุฏุขูุฑ \"{task}\" ุญุฐู ุดุฏ."
MSG_REMINDER_LIMIT_REACHED_FREE = "ุดูุง ุจู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุงุฏุขูุฑูุง ูุฌุงุฒ ({limit}) ุจุฑุง ฺฉุงุฑุจุฑุงู ุฑุงฺฏุงู ุฑุณุฏูโุงุฏ. ุจุฑุง ุซุจุช ุงุฏุขูุฑูุง ุจุดุชุฑุ ูุทูุงู ุงุดุชุฑุงฺฉ ุฎูุฏ ุฑุง ูฺู ฺฉูุฏ."
MSG_REMINDER_LIMIT_REACHED_WITH_BUTTON = "ุดูุง ุจู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุงุฏุขูุฑูุง ูุฌุงุฒ ({limit}) ุจุฑุง ฺฉุงุฑุจุฑุงู {tier_name} ุฑุณุฏูโุงุฏ. ุจุฑุง ุงูุฒูุฏู ุงุฏุขูุฑโูุง ุจุดุชุฑุ ูุทูุงู ุงุดุชุฑุงฺฉ ุฎูุฏ ุฑุง ุงุฑุชูุง ุฏูุฏ."
MSG_REMINDER_LIMIT_REACHED_PREMIUM = "ุดูุง ุจู ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุงุฏุขูุฑูุง ูุฌุงุฒ ({limit}) ุจุฑุง ฺฉุงุฑุจุฑุงู ูฺู ุฑุณุฏูโุงุฏ." 